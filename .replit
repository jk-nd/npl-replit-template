# NPL + React Replit Template
# Build frontends on Replit that connect to Noumena Cloud

run = "cd frontend && npm run dev"
entrypoint = "frontend/src/App.tsx"

hidden = [".config", "node_modules", ".git", "dist"]

[nix]
channel = "stable-24_05"

[env]
PATH = "/home/runner/.npl/bin:${PATH}"

# Expose the dev server port
[[ports]]
localPort = 5173
externalPort = 80

[deployment]
run = ["sh", "-c", "cd frontend && npm run build && npm run preview"]

# Workflow buttons for common tasks
[workflows]

[workflows.setup]
name = "ğŸš€ Full Setup"
description = "Complete setup: env + install + deploy + client"
command = "make setup"

[workflows.env]
name = "âš™ï¸ Generate Environment"
description = "Generate .env from NPL_TENANT and NPL_APP"
command = "make env"

[workflows.install]
name = "ğŸ“¦ Install Dependencies"
description = "Install NPL CLI and npm dependencies"
command = "make install"

[workflows.deploy]
name = "â˜ï¸ Deploy to Cloud"
description = "Deploy NPL protocols to Noumena Cloud"
command = "make deploy"

[workflows.client]
name = "ğŸ”„ Generate API Client"
description = "Generate TypeScript API client from OpenAPI"
command = "make client"

[workflows.users]
name = "ğŸ‘¥ Provision Users"
description = "Provision seed users in Keycloak"
command = "make users"

[workflows.keycloak]
name = "ğŸ”‘ Configure Keycloak"
description = "Configure Keycloak client (redirect URIs)"
command = "make keycloak"

[workflows.run]
name = "â–¶ï¸ Start Dev Server"
description = "Start the development server"
command = "make run"

[workflows.build]
name = "ğŸ—ï¸ Build Production"
description = "Build frontend for production"
command = "make build"

[workflows.check]
name = "âœ… Validate NPL"
description = "Validate NPL code syntax and types"
command = "make check"

[workflows.test]
name = "ğŸ§ª Run Tests"
description = "Run NPL tests"
command = "make test"

[workflows.clean]
name = "ğŸ§¹ Clean"
description = "Clean generated files and dependencies"
command = "make clean"
